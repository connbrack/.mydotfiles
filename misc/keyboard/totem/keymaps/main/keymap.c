/* 
                                             ▀▀▀▀▀     ▀▀▀▀▀          ▀▀█▀▀
                                             ▄▀▀▀▄  ▄  ▄▀▀▀▄  ▄  ▄▀▀▀▄  █  ▄▀▀▀▄
                                             █   █  █  █   █  █  █   █  █  █   █
                                              ▀▀▀   █   ▀▀▀   █   ▀▀▀   ▀   ▀▀▀
                                                    █      ▄▄▄█▄▄▄    █   █  
                                                    ▀      █  █  █     █▄█
                                                  ▀▀▀▀▀    █  █  █      ▀   
                                                           ▀  ▀  ▀  D E F A U L T  
                                                                                                                                  
▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
*/

#include QMK_KEYBOARD_H
#include <stdio.h>
#include "totem.h"

// ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
// │ D E F I N I T I O N S                                                                                                  │
// └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
// ▝▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▘

// ┌─────────────────────────────────────────────────┐
// │ d e f i n e   l a y e r s                       │
// └─────────────────────────────────────────────────┘ 

enum totem_layers {
    _QWERTY,
    _SYMBOLS,
    _NUMBERS,
    _SPECIAL,
    _TRACK,
};

// ┌─────────────────────────────────────────────────┐
// │ d e f i n e   k e y c o d e s                   │
// └─────────────────────────────────────────────────┘

enum custom_keycodes {
    CTL_EXLM = SAFE_RANGE,
    SPL_STB = SAFE_RANGE + 1,
    SYMBOLS,
    NUMBERS,
    SPECIAL,
    TRACK
  };

// ┌─────────────────────────────────────────────────┐
// │ d e f i n e   m a c r o n a m e s               │
// └─────────────────────────────────────────────────┘

// LEFT HAND HOME ROW MODS QWERTY ├──────────────────┐

#define CTL_A MT(MOD_LCTL, KC_A)
#define SFT_S MT(MOD_LSFT, KC_S)
#define ALT_D MT(MOD_LALT, KC_D)

#define CTL_1 MT(MOD_LCTL, KC_1)
#define SFT_2 MT(MOD_LSFT, KC_2)
#define ALT_3 MT(MOD_LALT, KC_3)

#define S_HOME MT(MOD_LSFT, KC_HOME)
#define A_PGDN MT(MOD_LALT, KC_PGDN)

// RIGHT HAND HOME ROW MODS QWERTY ├─────────────────┐

#define ALT_K MT(MOD_RALT, KC_K)
#define SFT_L MT(MOD_RSFT, KC_L)
#define CTL_QUOT MT(MOD_RCTL, KC_QUOT)

#define ALT_8 MT(MOD_RALT, KC_8)
#define SFT_9 MT(MOD_RSFT, KC_9)
#define CTL_0 MT(MOD_RCTL, KC_0)

#define A_UP RALT_T(KC_UP)
#define S_RGHT RSFT_T(KC_RGHT)

// SPECIAL                         ├─────────────────┐
#define S_ENT RSFT_T(KC_ENT)
#define C_TAB RCTL(KC_TAB)
#define C_S_TAB RCS(KC_TAB)
#define C_S_X RCS(KC_X)
#define C_S_C RCS(KC_C)
#define C_S_V RCS(KC_V)
#define S_TAB RSFT(KC_TAB)


// LAYERS                          ├─────────────────┐
#define QWERTY TO(_QWERTY)
#define SYMBOLS MO(_SYMBOLS)
#define SPECIAL MO(_SPECIAL)
#define NUMBERS MO(_NUMBERS)
#define NUM_ESC LT(NUMBERS,KC_ESC)
#define TRACK TO(_TRACK)


// ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
// │ K E Y M A P S                                                                                                          │
// └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
// ▝▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▘

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

 /*
   ┌─────────────────────────────────────────────────┐
   │ q w e r t y                                     │      ╭╮╭╮╭╮╭╮
   └─────────────────────────────────────────────────┘      │╰╯╰╯╰╯│
             ┌─────────┬─────────┬─────────┬─────────┬──────╨──┐┌──╨──────┬─────────┬─────────┬─────────┬─────────┐
     ╌┄┈┈───═╡    Q    │    W    │    E    │    R    │    T    ││    Y    │    U    │    I    │    O    │    P    │   
             ├─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┤
             │  CTL_A  │  SFT_S  │  ALT_D  │    F    │    G    ││    H    │    J    │  ALT_K  │  SFT_L  │  CTL_'  │    
   ┌─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┐
   │         │    Z    │    X    │    C    │    V    │    B    ││    N    │    M    │    ,    │    .    │    /    │         │
   └─────────┴─────────┴─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┴─────────┴─────────┘
                                 │   GUI   │  SYMBL  │   SPC   ││  S_ENT  │ NUM_ESC │   ALT   │  
                                 └─────────┴─────────┴─────────┘└─────────┴─────────┴─────────┘*/ 
   [_QWERTY] = LAYOUT(
 //╷         ╷         ╷         ╷         ╷         ╷         ╷╷         ╷         ╷         ╷         ╷         ╷         ╷
              KC_Q,     KC_W,     KC_E,     KC_R,     KC_T,      KC_Y,     KC_U,     KC_I,     KC_O,     KC_P,  
              CTL_A,    SFT_S,    ALT_D,    KC_F,     KC_G,      KC_H,     KC_J,     ALT_K,    SFT_L,    CTL_QUOT,    
    XXXXXXX,  KC_Z,     KC_X,     KC_C,     KC_V,     KC_B,      KC_N,     KC_M,     KC_COMM,  KC_DOT,   KC_SLSH,  XXXXXXX,
                                  KC_LGUI,  SYMBOLS,  KC_SPC,    S_ENT,    NUM_ESC,  KC_RALT
 ),

/*

   ╺━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸

   ┌─────────────────────────────────────────────────┐
   │ SYMBOLS                                         │      ╭╮╭╮╭╮╭╮
   └─────────────────────────────────────────────────┘      │╰╯╰╯╰╯│
             ┌─────────┬─────────┬─────────┬─────────┬──────╨──┐┌──╨──────┬─────────┬─────────┬─────────┬─────────┐
     ╌┄┈┈───═╡   ESC   │    <    │    `    │    >    │    +    ││    |    │    {    │    ~    │    }    │  BSPC   │   
             ├─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┤
             │    !    │    ^    │    =    │    $    │    *    ││    #    │    (    │    -    │    )    │    :    │    
   ┌─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┐
   │         │    ?    │    &    │    @    │    %    │         ││    ;    │    [    │    _    │    ]    │    \    │         │
   └─────────┴─────────┴─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┴─────────┴─────────┘
                                 │   GUI   │   ||||  │  SPACE  ││  ENTER  │ SPECIAL │   ALT   │  
                                 └─────────┴─────────┴─────────┘└─────────┴─────────┴─────────┘*/ 

   [_SYMBOLS] = LAYOUT(
 //╷         ╷         ╷         ╷         ╷         ╷         ╷╷         ╷         ╷         ╷         ╷         ╷         ╷
              KC_ESC,   KC_LT,    KC_GRV,   KC_GT,    KC_PPLS,   KC_PIPE,  KC_LCBR,  KC_TILD,  KC_RCBR,  KC_BSPC, 
              CTL_EXLM, KC_CIRC,  KC_PEQL,  KC_DLR,   KC_ASTR,   KC_HASH,  KC_LPRN,  KC_PMNS,  KC_RPRN,  KC_COLN, 
    XXXXXXX,  KC_QUES,  KC_AMPR,  KC_AT,    KC_PERC,  KC_NO,     KC_SCLN,  KC_LBRC,  KC_UNDS,  KC_RBRC,  KC_BSLS,  XXXXXXX,
                                  KC_LGUI,  KC_TRNS,  KC_SPC,    KC_ENT,   SPECIAL,  KC_RALT
 ),


 /*
   ╺━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
   
   ┌─────────────────────────────────────────────────┐
   │ NUMBERS                                         │      ╭╮╭╮╭╮╭╮
   └─────────────────────────────────────────────────┘      │╰╯╰╯╰╯│
             ┌─────────┬─────────┬─────────┬─────────┬──────╨──┐┌──╨──────┬─────────┬─────────┬─────────┬─────────┐
     ╌┄┈┈───═╡   ESC   │         │         │         │         ││         │         │         │         │  BSPC   │   
             ├─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┤
             │    1    │    2    │    3    │    4    │    5    ││    6    │    7    │    8    │    9    │    0    │    
   ┌─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┐
   │         │         │         │         │         │         ││         │         │    ,    │    .    │    \    │         │
   └─────────┴─────────┴─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┴─────────┴─────────┘
                                 │   GUI   │ SPL_STB │   TAB   ││  ENTER  │   ||||  │   ALT   │  
                                 └─────────┴─────────┴─────────┘└─────────┴─────────┴─────────┘ */ 

   [_NUMBERS] = LAYOUT(
 //╷         ╷         ╷         ╷         ╷         ╷         ╷╷         ╷         ╷         ╷         ╷         ╷         ╷
              KC_ESC,   XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,   XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,  KC_BSPC, 
              CTL_1,    SFT_2,    ALT_3,    KC_4,      KC_5,     KC_6,     KC_7,     ALT_8,    SFT_9,     CTL_0, 
    XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,   XXXXXXX,  XXXXXXX,  KC_COMM,  KC_DOT,   KC_SLSH,  XXXXXXX,
                                  KC_LGUI,  SPL_STB,  KC_TAB,    KC_ENT,   KC_TRNS,  KC_RALT

 ),
 /*
   ╺━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
   
   ┌─────────────────────────────────────────────────┐
   │ SPECIAL                                         │      ╭╮╭╮╭╮╭╮
   └─────────────────────────────────────────────────┘      │╰╯╰╯╰╯│
             ┌─────────┬─────────┬─────────┬─────────┬──────╨──┐┌──╨──────┬─────────┬─────────┬─────────┬─────────┐
     ╌┄┈┈───═╡   ESC   │         │         │  PLAY   │         ││         │  PG_UP  │ C_S_TAB │  C_TAB  │   DEL   │   
             ├─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┤
             │   CTL   │   HOME  │ PG_DOWN │   END   │         ││   LEFT  │  DOWN   │    UP   │  RIGHT  │    Ö    │
   ┌─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┐
   │  TRACK  │         │         │         │         │         ││         │         │  VOL_D  │  VOL_U  │  VOL_X  │         │
   └─────────┴─────────┴─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┴─────────┴─────────┘
                                 │   GUI   │  ||||   │  SPACE  ││  ENTER  │  ||||   │   ALT   │  
                                 └─────────┴─────────┴─────────┘└─────────┴─────────┴─────────┘ */ 

   [_SPECIAL] = LAYOUT(
 //╷         ╷         ╷         ╷         ╷         ╷         ╷╷         ╷         ╷         ╷         ╷         ╷         ╷
              KC_ESC,   XXXXXXX,  XXXXXXX,  KC_MPLY,  XXXXXXX,   XXXXXXX,  KC_PGUP,   C_S_TAB,  C_TAB,     KC_DEL, 
              KC_LCTL,  S_HOME,   A_PGDN,   KC_END,   XXXXXXX,   KC_LEFT,  KC_DOWN,   A_UP,     S_RGHT,    KC_RCTL, 
    TRACK,    XXXXXXX,  C_S_X,    C_S_C,    C_S_V,    XXXXXXX,   KC_BRID,  KC_BRIU,   KC_VOLD,  KC_VOLU,   KC_MUTE, XXXXXXX, 
                                  KC_LGUI,  KC_TRNS,  KC_SPC,    KC_ENT,   KC_TRNS,   KC_RALT
 ),

 /*
   ╺━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸
   
   ┌─────────────────────────────────────────────────┐
   │ T R A C K                                       │      ╭╮╭╮╭╮╭╮
   └─────────────────────────────────────────────────┘      │╰╯╰╯╰╯│
             ┌─────────┬─────────┬─────────┬─────────┬──────╨──┐┌──╨──────┬─────────┬─────────┬─────────┬─────────┐
     ╌┄┈┈───═╡  ESC    │    1    │    2    │    3    │    7    ││         │         │         │    O    │  BSPC   │   
             ├─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┤
             │         │         │         │         │    G    ││         │  LEFT   │   UP    │  RIGHT  │         │   
   ┌─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┐
   │ QWERTY  │         │         │         │         │         ││         │         │  DOWN   │         │         │         │
   └─────────┴─────────┴─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┴─────────┴─────────┘
                                 │         │         │  SPACE  ││  ENTER  │   ESC   │         │  
                                 └─────────┴─────────┴─────────┘└─────────┴─────────┴─────────┘ */ 
 //
   [_TRACK] = LAYOUT(
 //╷         ╷         ╷         ╷         ╷         ╷         ╷╷         ╷         ╷         ╷         ╷         ╷         ╷
              KC_ESC,   KC_1,     KC_2,     KC_3,     KC_7,      XXXXXXX,  XXXXXXX,  XXXXXXX,  KC_O,     KC_BSPC,   
              XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,  KC_G,      XXXXXXX,  KC_LEFT,  KC_UP,    KC_RGHT,  XXXXXXX,
    QWERTY,   XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,   XXXXXXX,  XXXXXXX,  KC_DOWN,  XXXXXXX,  XXXXXXX,   XXXXXXX,
                                  XXXXXXX,  XXXXXXX,  KC_SPC,    KC_ENT,   KC_ESC,   XXXXXXX  
 )
/*
   ╺━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸

   ┌─────────────────────────────────────────────────┐
   │ t e m p l a t e                                 │      ╭╮╭╮╭╮╭╮
   └─────────────────────────────────────────────────┘      │╰╯╰╯╰╯│
             ┌─────────┬─────────┬─────────┬─────────┬──────╨──┐┌──╨──────┬─────────┬─────────┬─────────┬─────────┐
     ╌┄┈┈───═╡         │         │         │         │         ││         │         │         │         │         │   
             ├─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┤
             │         │         │         │         │         ││         │         │         │         │         │    
   ┌─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┐
   │         │         │         │         │         │         ││         │         │         │         │         │         │
   └─────────┴─────────┴─────────┼─────────┼─────────┼─────────┤├─────────┼─────────┼─────────┼─────────┴─────────┴─────────┘
                                 │         │         │         ││         │         │         │  
                                 └─────────┴─────────┴─────────┘└─────────┴─────────┴─────────┘ 

   [_TEMPLATE] = LAYOUT(
 //╷         ╷         ╷         ╷         ╷         ╷         ╷╷         ╷         ╷         ╷         ╷         ╷         ╷
              _______,  _______,  _______,  _______,   _______,  _______,  _______,  _______,  _______,   _______,  
              _______,  _______,  _______,  _______,   _______,  _______,  _______,  _______,  _______,   _______,
    _______,  _______,  _______,  _______,  _______,   _______,  _______,  _______,  _______,  _______,   _______, _______,
                                  _______,  _______,   _______,  _______,  _______,  _______,
 ),
*/
};



// ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
// │ M A C R O S                                                                                                            │
// └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
// ▝▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▘

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  static uint16_t ctl_exlm_timer;
  static uint16_t spl_stb_timer;

  switch (keycode) {
  case CTL_EXLM:
    if (record->event.pressed) {
      ctl_exlm_timer = timer_read();
      add_mods(MOD_BIT(KC_LCTL));
    } else {
      del_mods(MOD_BIT(KC_LCTL));
      if (timer_elapsed(ctl_exlm_timer) < TAPPING_TERM) {
        tap_code16(KC_EXLM);
      }
    }
    return false;

  case SPL_STB:
    if (record->event.pressed) {
      spl_stb_timer = timer_read();
      layer_on(_SPECIAL);
    } else {
      layer_off(_SPECIAL);
      if (timer_elapsed(spl_stb_timer) < TAPPING_TERM) {
        tap_code16(S(KC_TAB));
      }
    }
    return false;
  }
  return true;
}
/*
  ╺━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸


                                                          ██████
                                                            ██  ▄▄▄▄
                                                            ██ ██▀▀██
                                                            ▀▀ ██▄▄██
                                                        ██████  ▀▀▀▀
                                                          ██ ▄▄▄▄▄▄
                                                          ██ ██▀▀▀▀
                                                          ██ ██████
                                                             ██▄▄▄▄
                                                             ▀▀▀▀▀▀
                                                           ████████
                                                           ██ ██ ██
                                                           ██ ██ ██
                                                           ▀▀ ▀▀ ▀▀
                                                          ████████

*/



